FROM nginx:alpine
RUN apk add --no-cache imagemagick
COPY --chown=nobody:nobody ./public /guest-portal/public
COPY --chown=nginx:nginx ./resources/nginx.conf /etc/nginx/nginx.conf
COPY --chown=nginx:nginx ./resources/convert.sh /guest-portal/convert.sh
EXPOSE 8080
USER nginx
WORKDIR /guest-portal
CMD echo -e "rewrite ^/guest/s/${UNIFI_SITE} /;" > /tmp/redirect.nginx; chmod 400 /tmp/redirect.nginx; nginx
